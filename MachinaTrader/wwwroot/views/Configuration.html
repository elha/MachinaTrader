<script src="/js/jquery-cron.js"></script>



<!-- qTip2 -->
<link href="/vendors/qtip2/css/jquery.qtip.min.css" rel="stylesheet">
<script src="/vendors/qtip2/js/jquery.qtip.min.js"></script>


<style>
    .cron-period > select {
        display: inline;
        width: initial;
    }

    .cron-block > select {
        display: inline;
        width: initial;
    }
</style>


<div class="row animated fadeIn" id="apiMainConfig" v-if="apiMainConfigData && allStrategiesData && exchangeCoinsData">

    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <i class="fab fa-btc"></i>System Configuration
                <div class="card-actions">
                    <a href="#" class="btn-minimize" data-widget="collapse"><i class="fas fa-angle-up"></i></a>
                </div>
            </div>
            <div class="card-body p-0">
                <table class="table table-hover table-striped">
                    <tr>
                        <td width="300px">
                            <span class="qTip" title="Web Port to use for MachinaTrader">Web Port <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                <strong>Default:</strong> 5000
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control integer" name="SystemOptions.WebPort" v-bind:value="apiMainConfigData['systemOptions']['webPort']" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="qTip" title="Database for MachinaTrader">Database <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                LiteDB have no dependencies (running database server)
                                <br />MongoDB is faster but need a server
                                <br /><br /><strong>Default:</strong> LiteDB
                            </div>
                        </td>
                        <td>
                            <select id="database" name="SystemOptions.Database" class="select2">
                                <option :selected="apiMainConfigData['systemOptions']['database'] == 'MongoDB'" value="MongoDB" data-icon="fal fa-database">&nbsp;&nbsp;MongoDB</option>
                                <option :selected="apiMainConfigData['systemOptions']['database'] == 'LiteDB'" value="LiteDB" data-icon="fal fa-database">&nbsp;&nbsp;LiteDB</option>
                            </select>
                        </td>
                        
                    </tr>
                    <tr>
                        <td width="300px">
                            <span class="qTip" title="Theme for MachinaTrader">Theme <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                <strong>Default:</strong> light
                            </div>
                        </td>
                        <td>
                            <select id="theme" name="SystemOptions.Theme" class="select2">
                                <option :selected="apiMainConfigData['systemOptions']['theme'] == 'light'" value="light" data-icon="fal fa-sun">&nbsp;&nbsp;Light</option>
                                <option :selected="apiMainConfigData['systemOptions']['theme'] == 'dark'" value="dark" data-icon="fal fa-moon">&nbsp;&nbsp;Dark</option>
                            </select>
                        </td>
                    </tr>

                </table>
            </div>
        </div>
    </div>
    
    <div class="col-md-12" id="databaseSettings">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-palette"></i>MongoDB Options
                <div class="card-actions">
                    <a href="#" class="btn-minimize" data-widget="collapse"><i class="fas fa-angle-up"></i></a>
                </div>
            </div>
            <div class="card-body p-0">
                <table class="table table-hover table-striped">
                    <tr>
                        <td width="300px">
                            <span class="qTip" title="Port">Url <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Host where your MongoDB is running.
                                <br /><br /><strong>Default:</strong> <i>127.0.0.1</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control string" name="SystemOptions.MongoDbOptions.Host" v-bind:value="apiMainConfigData['systemOptions']['mongoDbOptions']['host']" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="qTip" title="Port">Port <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Port where your MongoDB is running.
                                <br /><br /><strong>Default:</strong> <i>27017</i>
                            </div>
                        </td>
                        <td>
                            <input type="number" class="form-control integer" name="SystemOptions.MongoDbOptions.Port" v-bind:value="apiMainConfigData['systemOptions']['mongoDbOptions']['port']" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="qTip" title="Username">Username <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                If you are running localhost just let it empty.
                                <br /><br /><strong>Default:</strong> <i>null</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control string" name="SystemOptions.MongoDbOptions.Username" v-bind:value="apiMainConfigData['systemOptions']['mongoDbOptions']['username']" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="qTip" title="Password">Password <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                If you are running localhost just let it empty.
                                <br /><br /><strong>Default:</strong> <i>null</i>
                            </div>
                        </td>
                        <td>
                            <input type="password" class="form-control string" name="SystemOptions.MongoDbOptions.Password" v-bind:value="apiMainConfigData['systemOptions']['mongoDbOptions']['password']" />
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-palette"></i>Display Configuration
                <div class="card-actions">
                    <a href="#" class="btn-minimize" data-widget="collapse"><i class="fas fa-angle-up"></i></a>
                </div>
            </div>
            <div class="card-body p-0">
                <table class="table table-hover table-striped">
                    <tr>
                        <td width="300px">
                            <span class="qTip" title="Display fiat currency">Display fiat currency <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                All totals are calculated in this fiat currency.
                                <br /><br /><strong>Default:</strong> <i>USD</i>
                            </div>
                        </td>
                        <td>
                            <select id="displayfiatcurrency" name="DisplayOptions.DisplayFiatCurrency" class="select2">
                                <option :selected="apiMainConfigData['displayOptions']['displayFiatCurrency'] == 'USD'" value="USD" data-icon="fal fa-dollar-sign">&nbsp;&nbsp;USD</option>
                                <option :selected="apiMainConfigData['displayOptions']['displayFiatCurrency'] == 'EUR'" value="EUR" data-icon="fal fa-euro-sign">&nbsp;&nbsp;EUR</option>
                            </select>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <i class="fab fa-telegram"></i>Telegram Configuration
                <div class="card-actions">
                    <a href="#" class="btn-minimize" data-widget="collapse"><i class="fas fa-angle-up"></i></a>
                </div>
            </div>
            <div class="card-body p-0">
                <table class="table table-hover table-striped">
                    <tr>
                        <td width="300px">
                            <span class="qTip" title="Telegram ChatId">Telegram ChatId <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                <strong>Sample:</strong> 493867000
                                <br /><br /><strong>Default:</strong> <i>none</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control string" name="TelegramOptions.TelegramChatId" v-bind:value="apiMainConfigData['telegramOptions']['telegramChatId']" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="qTip" title="Telegram Bot Token">Telegram Bot Token <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Please enter here your telegram chat id
                                <br /><strong>Sample:</strong> 608444444:AAAA1XsvQOYO-uE3l8GX8TdyShP-lodFIyo
                                <br /><br /><strong>Default:</strong> <i>none</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control string" name="TelegramOptions.TelegramBotToken" v-bind:value="apiMainConfigData['telegramOptions']['telegramBotToken']" />
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="col-md-12" v-for="(exchangeValue, exchangeKey) in apiMainConfigData['exchangeOptions']">
        <div class="card">
            <div class="card-header">
                <i class="fab fa-btc"></i>{{exchangeValue['exchange']}} Options
                <div class="card-actions">
                    <a href="#" class="btn-minimize" data-widget="collapse"><i class="fas fa-angle-up"></i></a>
                </div>
            </div>
            <div class="card-body p-0">
                <table class="table table-hover table-striped">
                    <tr>
                        <td width="300px">
                            <span class="qTip" title="Exchange Id">Exchange <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Please enter ExchangeId your want to use
                                <br />0 - Binance
                                <br /><br /><strong>Default:</strong> <i>0</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control integer" name="ExchangeOptions[].Exchange" v-bind:value="exchangeValue['exchange']" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="qTip" title="ApiKey">ApiKey <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Please enter your Api Key
                                <br /><br /><strong>Default:</strong> <i>none</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control string" name="ExchangeOptions[].ApiKey" v-bind:value="exchangeValue['apiKey']" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="qTip" title="ApiSecret">ApiSecret <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Please enter your Api Secret
                                <br /><br /><strong>Default:</strong> <i>none</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control string" name="ExchangeOptions[].ApiSecret" v-bind:value="exchangeValue['apiSecret']" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="qTip" title="PassPhrase">PassPhrase <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Please enter your PassPhrase (if needed for your exchange)
                                <br /><br /><strong>Default:</strong> <i>none</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control string" name="ExchangeOptions[].PassPhrase" v-bind:value="exchangeValue['passPhrase']" />
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <i class="fab fa-btc"></i>Trading Configuration
                <div class="card-actions">
                    <a href="#" class="btn-minimize" data-widget="collapse"><i class="fas fa-angle-up"></i></a>
                </div>
            </div>
            <div class="card-body p-0">
                <table class="table table-hover table-striped">
                    <tr>
                        <td>
                            <span class="qTip" title="Buy Timer">BuyTimer <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Select interval to check for new buys
                                <br /> You can also choose custom option to directly change cron (Quartz)
                                <br /><br /><strong>Default:</strong> <i>0 0/5 * * * ?</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control string" name="TradeOptions.BuyTimer" v-bind:value="apiMainConfigData['tradeOptions']['buyTimer']" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="qTip" title="Buy Timer">SellTimer <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Select interval to check for new sells
                                <br /> You can also choose custom option to directly change cron (Quartz)
                                <br /><br /><strong>Default:</strong> <i>0 0/5 * * * ?</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control string" name="TradeOptions.SellTimer" v-bind:value="apiMainConfigData['tradeOptions']['sellTimer']" />
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <span class="qTip" title="Paper Trade">PaperTrade <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Set to true to simulate trades.
                                <br /> While PaperTrade is true no real trades will get executed
                                <br /><br /><strong>Default:</strong> <i>true</i>
                            </div>
                        </td>
                        <td>
                            <label class="switch switch-label switch-primary">
                                <input type="checkbox" class="switch-input bool" name="TradeOptions.PaperTrade" :checked="apiMainConfigData['tradeOptions']['paperTrade']" />
                                <span class="switch-slider" data-checked="✓" data-unchecked="✕"></span>
                            </label>
                        </td>
                    </tr>


                    <tr>
                        <td>
                            <span class="qTip" title="Amount to invest per trade">AmountToInvestPerTrade <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                How many base currency (usually BTC) will be used per trade
                                <br /><br /><strong>Default:</strong> <i>120</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control float" name="TradeOptions.AmountToInvestPerTrade" v-bind:value="apiMainConfigData['tradeOptions']['amountToInvestPerTrade']" />
                        </td>
                    </tr>


                    <tr>
                        <td>
                            <span class="qTip" title="Cancel unbought orders each cycle">Max open time to buy <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Cancel unbought orders after this time cycle (in seconds)
                                <br /><br /><strong>Default:</strong> <i>600</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control float" name="TradeOptions.MaxOpenTimeBuy" v-bind:value="apiMainConfigData['tradeOptions']['maxOpenTimeBuy']" />
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <span class="qTip" title="Default strategy">DefaultStrategy <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Select the strategy to use for buy/sell
                                <br /><br /><strong>Default:</strong> <i>The Scalper</i>
                            </div>
                        </td>
                        <td>
                            <select id="tradingStrategy" name="TradeOptions.DefaultStrategy" class="select2">
                                <option v-for="(value, key) in allStrategiesData" :selected="apiMainConfigData['tradeOptions']['defaultStrategy'] == allStrategiesData[key]['ClassName']" v-bind:value="allStrategiesData[key]['ClassName']" data-icon="fas fa-chart-line">&nbsp;&nbsp;{{allStrategiesData[key]['Name']}}</option>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <span class="qTip" title="Default strategy">DefaultStrategyParameters <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Parameters for strategy to use for buy/sell
                                <br /><br /><strong>Default:</strong> <i></i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control string" name="TradeOptions.DefaultStrategyParameters" v-bind:value="apiMainConfigData['tradeOptions']['defaultStrategyParameters']" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <span class="qTip" title="QuoteCurrency">QuoteCurrency <i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Enter your Base Currency
                                <br /><br /><strong>Default:</strong> <i>BTC</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control string" name="TradeOptions.QuoteCurrency" v-bind:value="apiMainConfigData['tradeOptions']['quoteCurrency']" />
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <span class="qTip" title="Trade Assets">TradeAssets<i class="fal fa-question-circle"></i></span>
                            <div style="display: none;">
                                Trade this coins
                                <br /> Depends on your current exchange.
                                <br /><br /><strong>Default:</strong> <i>ETH,BTC</i>
                            </div>
                        </td>
                        <td>
                            <input type="text" class="form-control string" name="TradeOptions.TradeAssets" v-bind:value="apiMainConfigData['tradeOptions']['tradeAssets']" />
                        </td>
                    </tr>

                </table>
            </div>
        </div>
    </div>

    <div class="col-md-12">
        <button type="button" class="btn btn-success btn-block" v-on:click="serializeForm();">Save</button>
    </div>

    <br />
    <br />
    <br />
</div>

<script type="text/javascript">
    var pagefunction = function () {
        $(document).ready(function () {
            var t = document.getElementById("database");
            if (t.value === 'LiteDB') {
                $('#databaseSettings').css("display", "none");
            }
        });
        document.getElementById("database").onchange = function (e) {
            if (this.value === 'MongoDB') {
                $('#databaseSettings').removeAttr("style");
            }
            if (this.value === 'LiteDB') {
                $('#databaseSettings').css("display", "none");
            }
        };
        
        /*$('#apiMainConfig').find(':input').each(function () {
            $(this).on("propertychange, change, keyup, paste, input", function () {
                event.preventDefault();
                postFormData("apiMainConfig", "/api/config/mainConfig", false);
            });
            $(this).on('ifChanged', function (event) {
                event.preventDefault();
                postFormData("apiMainConfig", "/api/config/mainConfig", false);
            });
        });

        $('#apiMainConfig').find(':input[type=checkbox]').each(function () {
            $(this).change(function () {
                event.preventDefault();
                postFormData("apiMainConfig", "/api/config/mainConfig", false);
            });
        });*/

        $('.qTip').on('mouseover', function (event) {
            $(this).qtip({
                content: {
                    title: $(this).attr('title'),
                    text: $(this).next('div').clone() // Use the "div" element next to this for the content
                },
                position: {
                    my: 'top center',  // Position my top left...
                    at: 'bottom center' // at the bottom right of...
                },
                style: {
                    classes: 'qtip-shadow qtip-bootstrap',
                    tip: {
                        corner: true, // Use position.my by default
                        //mimic: false, // Don't mimic a particular corner
                        width: 25,
                        height: 10,
                        //border: true, // Detect border from tooltip style
                        offset: 10 // Do not apply an offset from corner
                    }
                },
                prerender: false,
                overwrite: true,
                show: {
                    event: event.type,
                    ready: true
                },
                hide: {
                    event: 'mouseout'
                },
                events: {
                    hidden: function (event, api) {
                        $(this).qtip('destroy', true);
                    }
                }
            }, event);
        });


        $(".select2").select2({
            theme: "bootstrap",
            templateResult: selectPickerImage,
            templateSelection: selectPickerImage,
            width: "100%"
        });

        $('.select2-multiple').select2({
            placeholder: 'Select Currencies',
            //allowClear: true,
            multiple: true,
            tags: true,
            theme: "bootstrap",
            width: "100%",
            createTag: function (item) {
                return {
                    id: item.term,
                    text: item.term
                };
            }
        });

    };

    var apiMainConfig = new Vue({
        el: '#apiMainConfig',
        parent: vueMain,

        data: {
            apiMainConfigData: null,
            allStrategiesData: null,
            exchangeCoinsData: null
        },

        created: function () {
            this.fetchData();
        },

        methods: {
            serializeForm: function () {
                postFormData("apiMainConfig", "/api/config/mainConfig", true);
            },
            isBool: function (data) {
                if ((typeof (data) === "boolean")) {
                    return true;
                }
                return false;
            },
            fetchData: function () {
                var self = this;


                $.get('/api/config/mainConfig', function (data) {
                    self.apiMainConfigData = data;
                    $.get('/api/backtester/backtesterStrategy', function (data) {
                        self.allStrategiesData = data;
                        $.get('/api/trading/exchangeCurrencies', function (data) {
                            self.exchangeCoinsData = data;
                            self.$nextTick(function () {
                                pagefunction();
                            });
                        });
                    });
                });
            }
        }
    });


</script>
